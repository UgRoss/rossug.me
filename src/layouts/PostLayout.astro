---
import '@/styles/global.css'
import type { PostLayoutProps } from '@/types'

import BaseHead from '@/components/layout/BaseHead.astro'
import Footer from '@/components/layout/Footer.astro'
import CopyCode from '@/components/ui/CopyCode.astro'
import ImageOptimizer from '@/components/ui/ImageOptimizer.astro'
import ImageViewer from '@/components/ui/ImageViewer.astro'
import FootnoteScroll from '@/components/widgets/FootnoteScroll.astro'
import FormattedDate from '@/components/widgets/FormattedDate.astro'
import { themeConfig } from '@/config'
import BaseLayout from '@/layouts/BaseLayout.astro'

const { pubDate, title } = Astro.props as PostLayoutProps

const postSlug = Astro.url.pathname.split('/').filter(Boolean).pop() || ''
const ogImage = `/open-graph/${postSlug}.png`
---

<BaseLayout
  description={themeConfig.site.description}
  title={`${title} · ${themeConfig.site.title}`}
  type="post"
>
  <BaseHead
    description={themeConfig.site.description}
    ogImage={ogImage}
    slot="head"
    title={`${title} · ${themeConfig.site.title}`}
  />
  <div class="post-container">
    <main>
      <div class="prose xl:prose-lg">
        <div class="title">
          <h1>{title}</h1>
          <div class="date">
            <FormattedDate context="post" date={pubDate} />
          </div>
        </div>
        <slot />
      </div>
    </main>
    <ImageOptimizer />
    <FootnoteScroll />
    <CopyCode />
    {themeConfig.post.imageViewer && <ImageViewer />}
    {themeConfig.general.footer && <Footer />}
  </div>
</BaseLayout>

<style>
  .post-container {
    display: flex;
    flex-direction: column;
    flex: 1;
  }

  .post-container main {
    flex: 1;
  }
</style>
