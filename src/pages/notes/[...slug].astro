---
import { type CollectionEntry, getCollection } from 'astro:content'
import { render } from 'astro:content'

import PostLayout from '@/layouts/PostLayout.astro'

type Props = CollectionEntry<'notes'>

export async function getStaticPaths() {
  const notes = await getCollection('notes')
  return notes
    .filter((note) => !note.id.startsWith('_'))
    .map((note) => ({
      params: { slug: note.id },
      props: note
    }))
}

const note = Astro.props
const { Content, remarkPluginFrontmatter } = await render(note)

const readingTime = remarkPluginFrontmatter.readingTime
---

<PostLayout pubDate={note.data.pubDate} readingTime={readingTime} title={note.data.title}>
  <div class="mb-4">
    <a
      class="inline-block rounded-full bg-neutral-100 px-3 py-1 text-xs font-semibold tracking-wider text-neutral-600 uppercase transition-colors hover:bg-neutral-200 dark:bg-neutral-800 dark:text-neutral-400 dark:hover:bg-neutral-700"
      href={`/notes?category=${encodeURIComponent(note.data.category)}`}
    >
      {note.data.category}
    </a>
  </div>

  <Content />

  <div class="mt-8 border-t border-neutral-200 pt-6 dark:border-neutral-800">
    <a
      class="inline-flex items-center text-sm text-neutral-600 transition-colors hover:text-neutral-900 dark:text-neutral-400 dark:hover:text-neutral-100"
      href="/notes"
    >
      ‚Üê Back to all notes
    </a>
  </div>
</PostLayout>
