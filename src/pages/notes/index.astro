---
import { getCollection } from 'astro:content'

import NoteCard from '@/components/notes/NoteCard.astro'
import NotesList from '@/components/notes/NotesList'
import { themeConfig } from '@/config'
import IndexLayout from '@/layouts/IndexLayout.astro'

// Get all notes and sort by date (newest first)
const allNotes = await getCollection('notes')
const sortedNotes = allNotes
  .filter((note) => !note.id.startsWith('_'))
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())

// Extract unique categories
const categories = [...new Set(sortedNotes.map((note) => note.data.category))].sort()
---

<IndexLayout description="TILs (Today I Learned) and quick technical snippets" title={`Notes - ${themeConfig.site.title}`}>
  <div class="py-8">
    <div class="mb-8">
      <h1 class="text-3xl font-bold mb-2">Notes</h1>
      <p class="text-neutral-600 dark:text-neutral-400">
        TILs (Today I Learned) and quick technical snippets.
      </p>
    </div>

    <!-- React component for filtering controls -->
    <NotesList 
      categories={categories}
      client:load
      notes={sortedNotes.map((note) => ({
        category: note.data.category,
        excerpt: note.data.excerpt,
        id: note.id,
        title: note.data.title
      }))}
    />

    <!-- Render all cards initially, React will handle showing/hiding -->
    <div class="grid gap-6" id="notes-container">
      {sortedNotes.map((note) => (
        <div data-category={note.data.category} data-note-card data-note-id={note.id}>
          <NoteCard
            category={note.data.category}
            excerpt={note.data.excerpt}
            id={note.id}
            pubDate={note.data.pubDate}
            title={note.data.title}
          />
        </div>
      ))}
    </div>
  </div>
</IndexLayout>
